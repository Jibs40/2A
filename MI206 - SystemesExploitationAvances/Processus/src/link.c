#include <string.h>
#include <stdlib.h>
#include <libgen.h> // For basename

#include <unistd.h>

#include "utils.h"
#include <stdio.h>
int main(int argc, char *argv[])
{
    int is_sym = (argc > 1 && strcmp(argv[1], "-s") == 0);
    if (is_sym) {
        argc --;
        argv ++;
    }
    exit_if(argc < 2, "Syntax: link [-s] <source> [<dest>]");
    /*
     * Exercice: Supporter plusieurs sources et considèrer la destination comme
     * un répertoire.
     */

    const char *src = argv[1];
    const char *dest = (argc > 2) ? argv[2] : basename(argv[1]);
        printf("\n");

const char *destdir = argv[2];

    exit_if(symlinkat(src, AT_FDCWD, destdir) == -1,"Erreur creation répertoire");
    
    if (is_sym)
        exit_if(symlink(src, dest) == -1, "symlink");
    else
        exit_if(link(src, dest) == -1, "link");

    return EXIT_SUCCESS;
}
