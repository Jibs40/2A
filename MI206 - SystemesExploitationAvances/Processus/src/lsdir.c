#include <stdio.h>
#include <stdlib.h>

#include <dirent.h>
#include <unistd.h>

#include "utils.h"

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/stat.h>
#include <string.h>
#include <dirent.h>
#include "utils.h"

const char *dir_type(unsigned char type);

int list_dir(FILE *out, const char *path)
{
    DIR *dir = opendir(path);
    if (dir == NULL) return -1;

    struct dirent *entry; // man dirent for info on fields
    while ((entry = readdir(dir)) != NULL) {
        fprintf(out, "%s -> %llu %s\n",
                entry->d_name, entry->d_ino,
                dir_type(entry->d_type));
    }
    return closedir(dir);
}

int main(int argc, char *argv[])
{
    // Exercice: Ajouter l'option `-R` (recursive). Algorithmique.
    // Exercice: Ajouter l'option `-a` et `-A` (all et almost all). C.

    if (argc == 1)
        list_dir(stdout, ".");

    for (int i = 1; i < argc; i++)
        list_dir(stdout, argv[i]);

    return EXIT_SUCCESS;
}

const char *dir_type(unsigned char type)
{
    switch (type) {
        case DT_FIFO:
            return "FIFO";
        case DT_CHR:
            return "CHAR";
        case DT_DIR:
            return "DIR";
        case DT_BLK:
            return "BLOCK";
        case DT_REG:
            return "FILE";
        case DT_LNK:
            return "LINK";
        case DT_SOCK:
            return "SOCKET";
        default:
            return "UNKNOWN";
    }
}

