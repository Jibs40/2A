#include <stdio.h>
#include <stdlib.h>

#include <unistd.h>

#include "utils.h"

#include <sys/types.h>
#include <sys/wait.h>


int main(int argc, char *argv[])
{
     exit_if(argc!=2,"Syntaxe : <Nom Programme> <Nombre de fils>");
    int a;
    pid_t pid;
    char *tabpid;
    
    int nbr = atoi(argv[1]);

  printf("nombre de processus demandés : %d\n",nbr);

  for (int i =0 ; i < nbr ; ++i)
    {
      a = fork();
      switch (a)
	{ 
	    case -1:
	        printf("erreur\n");
        break;

	     case 0:
	        printf("Voici mon numéro : %d\n", i);
            break;

	    default: 
        {
            int status;
            pid_t pid = wait(&status);
            exit_if(pid==-1,"Erreur");
           // printf("Le fils a fini %d\n", WEXITSTATUS(status));
            break;
        }
	}
    }

  return EXIT_SUCCESS;
}
